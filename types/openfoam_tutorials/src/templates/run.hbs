#!/bin/bash

cd $1

module load openfoam_switcher
. switchFoam 6

# Tutorial example
cp -r $FOAM_TUTORIALS/incompressible/icoFoam/cavity simulation
cd simulation
blockMesh
decomposePar
foamJob -parallel -wait icoFoam

# Make dataset readable by PV
touch dataset.foam

# Unzip any obj file so they can be used as context
find . -name *.obj.gz -exec gzip -dk {} \;

# Gather context shapes in ../context
mkdir -p ../context
cd ../context
find ../simulation -name *.obj -exec ln -s {} ../context/ \;